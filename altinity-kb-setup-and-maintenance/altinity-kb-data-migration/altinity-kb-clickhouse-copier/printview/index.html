<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.119.0"><link rel=canonical type=text/html href=http://kb.altinity.com/altinity-kb-setup-and-maintenance/altinity-kb-data-migration/altinity-kb-clickhouse-copier/><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=icon href=/favicons/favicon.ico><title>clickhouse-copier | Altinity Knowledge Base</title><meta name=description content="clickhouse-copier
"><meta property="og:title" content="clickhouse-copier"><meta property="og:description" content="clickhouse-copier
"><meta property="og:type" content="website"><meta property="og:url" content="http://kb.altinity.com/altinity-kb-setup-and-maintenance/altinity-kb-data-migration/altinity-kb-clickhouse-copier/"><meta itemprop=name content="clickhouse-copier"><meta itemprop=description content="clickhouse-copier
"><meta name=twitter:card content="summary"><meta name=twitter:title content="clickhouse-copier"><meta name=twitter:description content="clickhouse-copier
"><link rel=preload href=/scss/main.min.9a54a9c72503f8776e09ecda5698f06b3e70d16c4f3289a7dc18fe487bc934a1.css as=style><link href=/scss/main.min.9a54a9c72503f8776e09ecda5698f06b3e70d16c4f3289a7dc18fe487bc934a1.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script>
<link rel=stylesheet href=/css/prism.css><meta name=keywords content></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 97.68 112.95"><defs><linearGradient id="linear-gradient" x1="49.43" y1="564.05" x2="21.19" y2="486.25" gradientTransform="matrix(1, 0, 0, -1, 0, 550.11)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#009cd0"/><stop offset=".16" stop-color="#02a0d4"/><stop offset=".33" stop-color="#08acdf"/><stop offset=".49" stop-color="#12c0f1"/><stop offset=".66" stop-color="#10bced"/><stop offset=".83" stop-color="#0ab0e2"/><stop offset="1" stop-color="#009cd0"/></linearGradient><linearGradient id="linear-gradient-2" x1="0" y1="472.36" x2="48.75" y2="472.36" xlink:href="#linear-gradient"/><linearGradient id="linear-gradient-3" x1=".05" y1="493.62" x2="24.5" y2="493.62" gradientTransform="matrix(1, 0, 0, -1, 0, 550.11)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff"/><stop offset=".03" stop-color="#f2f7fb"/><stop offset=".19" stop-color="#b3d2e7"/><stop offset=".34" stop-color="#7cb2d5"/><stop offset=".5" stop-color="#5097c7"/><stop offset=".64" stop-color="#2d83bc"/><stop offset=".78" stop-color="#1474b4"/><stop offset=".9" stop-color="#056bb0"/><stop offset="1" stop-color="#0068ae"/></linearGradient><linearGradient id="linear-gradient-4" x1="73.23" y1="507.9" x2="97.68" y2="507.9" gradientTransform="matrix(1, 0, 0, -1, 0, 550.11)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0068ae"/><stop offset=".12" stop-color="#046aaf"/><stop offset=".25" stop-color="#1072b3"/><stop offset=".38" stop-color="#257eba"/><stop offset=".5" stop-color="#418fc3"/><stop offset=".63" stop-color="#66a4ce"/><stop offset=".76" stop-color="#93bfdd"/><stop offset=".88" stop-color="#c7deed"/><stop offset="1" stop-color="#fff"/></linearGradient><linearGradient id="linear-gradient-5" x1="50.7" y1="522" x2="74.92" y2="522" gradientTransform="matrix(1, 0, 0, -1, 0, 550.11)" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#0068ae"/><stop offset=".09" stop-color="#096eb1"/><stop offset=".23" stop-color="#237db9"/><stop offset=".41" stop-color="#4d95c6"/><stop offset=".62" stop-color="#86b8d9"/><stop offset=".86" stop-color="#cfe3f0"/><stop offset="1" stop-color="#fff"/></linearGradient></defs><title>logo_1</title><g style="isolation:isolate"><g id="Layer_2" data-name="Layer 2"><g id="Layer_1-2" data-name="Layer 1"><path d="M97.68 56.29h0L73.23 42.21V98.58L97.68 112.7V56.29z" style="fill:#009cd0"/><path d="M73.23 42.21 97.68 56.32V28.09z" style="fill:#009cd0"/><path d="M73.25 42.2 97.68 28.09 73.25 14h0L48.79 28.08 73.23 42.19v0h0z" style="fill:#009cd0"/><path d="M73.34 14.12 48.89.0V0L24.45 14.18h0L.1 28.23h0L0 28.29l.09.05V56.46L24.45 42.4h0 .1.0L49.4 27.94 73.34 14.12z" style="fill:url(#linear-gradient)"/><path d="M48.75 84.87 24.45 70.52v-28L.21 56.53l-.12-.07v.14L0 56.66l.09.05V84.65L0 84.7l.09.06V113L24.3 99v0L48.75 84.87z" style="fill:url(#linear-gradient-2)"/><path d="M.05 56.44 24.5 70.55V42.32z" style="fill:#009cd0"/><path d="M.05 56.49 24.5 70.6V42.37z" style="mix-blend-mode:multiply;fill:url(#linear-gradient-3)"/><path d="M73.23 42.21 97.68 56.32V28.09z" style="mix-blend-mode:multiply;fill:url(#linear-gradient-4)"/><path d="M97.68 28.09 73.23 14v0L48.79 28.13 73.25 42.25v0z" style="mix-blend-mode:multiply;fill:url(#linear-gradient-5)"/></g></g></g></svg></span><span class=font-weight-bold>Altinity Knowledge Base</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.757df1a9cbbe2586b77969942ab7d321.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/altinity-kb-setup-and-maintenance/altinity-kb-data-migration/altinity-kb-clickhouse-copier/>Return to the regular view of this page</a>.</p></div><h1 class=title>clickhouse-copier</h1><div class=lead>clickhouse-copier</div><ul><li>1: <a href=#pg-e1f1d825521583c133a8d3bf2a72f6e7>clickhouse-copier 20.3 and earlier</a></li><li>2: <a href=#pg-4907e613a878d5b7819f49cc367b9f3f>clickhouse-copier 20.4 - 21.6</a></li><li>3: <a href=#pg-092d5c190f9504b9126ab5f7779a2089>Kubernetes job for clickhouse-copier</a></li></ul><div class=content><p>The description of the utility and its parameters, as well as examples of the config files that you need to create for the copier are in the official doc <a href=https://clickhouse.com/docs/en/operations/utilities/clickhouse-copier/ target=_blank>ClickHouse copier utility</a></p><p>The steps to run a task:</p><ol><li><p>Create a config file for clickhouse-copier (zookeeper.xml)</p><p><a href=https://clickhouse.com/docs/en/operations/utilities/clickhouse-copier/#format-of-zookeeper-xml target=_blank>ZooKeeper config format</a></p></li><li><p>Create a config file for the task (task1.xml)</p><p><a href=https://clickhouse.com/docs/en/operations/utilities/clickhouse-copier/#configuration-of-copying-tasks target=_blank>Copy task configuration</a></p></li><li><p>Create the task in ZooKeeper and start an instance of clickhouse-copier</p><p><code>clickhouse-copier --daemon --base-dir=/opt/clickhouse-copier --config=/opt/clickhouse-copier/zookeeper.xml --task-path=/clickhouse/copier/task1 --task-file=/opt/clickhouse-copier/task1.xml</code></p><p>If the node in ZooKeeper already exists and you want to change it, you need to add the <code>task-upload-force</code> parameter:</p><p><code>clickhouse-copier --daemon --base-dir=/opt/clickhouse-copier --config=/opt/clickhouse-copier/zookeeper.xml --task-path=/clickhouse/copier/task1 --task-file=/opt/clickhouse-copier/task1.xml --task-upload-force=1</code></p><p>If you want to run another instance of clickhouse-copier for the same task, you need to copy the config file (zookeeper.xml) to another server, and run this command:</p><p><code>clickhouse-copier --daemon --base-dir=/opt/clickhouse-copier --config=/opt/clickhouse-copier/zookeeper.xml --task-path=/clickhouse/copier/task1</code></p></li></ol><p>The number of simultaneously running instances is controlled be the <code>max_workers</code> parameter in your task configuration file. If you run more workers superfluous workers will sleep and log messages like this:</p><p><code>&lt;Debug> ClusterCopier: Too many workers (1, maximum 1). Postpone processing</code></p><h3 id=see-also>See also</h3><ul><li><a href=https://clickhouse.com/docs/en/operations/utilities/clickhouse-copier/ target=_blank>https://clickhouse.com/docs/en/operations/utilities/clickhouse-copier/</a></li><li>Никита Михайлов. Кластер ClickHouse ctrl-с ctrl-v. HighLoad++ Весна 2021 <a href=https://raw.githubusercontent.com/ClickHouse/clickhouse-presentations/master/highload2021/copier.pdf target=_blank>slides</a></li><li>21.7 have a huge bulk of fixes / improvements. <a href=https://github.com/ClickHouse/ClickHouse/pull/23518 target=_blank>https://github.com/ClickHouse/ClickHouse/pull/23518</a></li><li><a href=https://altinity.com/blog/2018/8/22/clickhouse-copier-in-practice target=_blank>https://altinity.com/blog/2018/8/22/clickhouse-copier-in-practice</a></li><li><a href=http://www.clickhouse.com.cn/topic/601fb322b06e5e0f21ba79e1 target=_blank>http://www.clickhouse.com.cn/topic/601fb322b06e5e0f21ba79e1</a></li><li><a href=https://github.com/getsentry/snuba/blob/master/docs/clickhouse-copier.md target=_blank>https://github.com/getsentry/snuba/blob/master/docs/clickhouse-copier.md</a></li><li><a href=https://hughsite.com/post/clickhouse-copier-usage.html target=_blank>https://hughsite.com/post/clickhouse-copier-usage.html</a></li><li><a href=https://www.jianshu.com/p/c058edd664a6 target=_blank>https://www.jianshu.com/p/c058edd664a6</a></li></ul></div></div><div class=td-content style=page-break-before:always><h1 id=pg-e1f1d825521583c133a8d3bf2a72f6e7>1 - clickhouse-copier 20.3 and earlier</h1><div class=lead>clickhouse-copier 20.3 and earlier</div><p>Clickhouse-copier was created to move data between clusters.
It runs simple INSERT…SELECT queries and can copy data between tables with different engine parameters and between clusters with different number of shards.
In the task configuration file you need to describe the layout of the source and the target cluster, and list the tables that you need to copy. You can copy whole tables or specific partitions.
Clickhouse-copier uses temporary distributed tables to select from the source cluster and insert into the target cluster.</p><h2 id=the-process-is-as-follows>The process is as follows</h2><ol><li>Process the configuration files.</li><li>Discover the list of partitions if not provided in the config.</li><li>Copy partitions one by one.<ol><li>Drop the partition from the target table if it’s not empty</li><li>Copy data from source shards one by one.<ol><li>Check if there is data for the partition on a source shard.</li><li>Check the status of the task in ZooKeeper.</li><li>Create target tables on all shards of the target cluster.</li><li>Insert the partition of data into the target table.</li></ol></li><li>Mark the partition as completed in ZooKeeper.</li></ol></li></ol><p>If there are several workers running simultaneously, they will assign themselves to different source shards.
If a worker was interrupted, another worker can be started to continue the task. The next worker will drop incomplete partitions and resume the copying.</p><h2 id=configuring-the-engine-of-the-target-table>Configuring the engine of the target table</h2><p>Clickhouse-copier uses the engine from the task configuration file for these purposes:</p><ul><li>to create target tables if they don’t exist.</li><li>PARTITION BY: to SELECT a partition of data from the source table, to DROP existing partitions from target tables.</li></ul><p>Clickhouse-copier does not support the old MergeTree format.
However, you can create the target tables manually and specify the engine in the task configuration file in the new format so that clickhouse-copier can parse it for its SELECT queries.</p><h2 id=how-to-monitor-the-status-of-running-tasks>How to monitor the status of running tasks</h2><p>Clickhouse-copier uses ZooKeeper to keep track of the progress and to communicate between workers.
Here is a list of queries that you can use to see what’s happening.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>--task-path /clickhouse/copier/task1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-- The task config
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>system</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>zookeeper</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>path</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&lt;task-path&gt;&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>name</span><span style=color:#f8f8f8;text-decoration:underline>                        </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ctime</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>mtime</span><span style=color:#f8f8f8;text-decoration:underline>           
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>----------------------------+---------------------+--------------------
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>description</span><span style=color:#f8f8f8;text-decoration:underline>                 </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2019</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>40</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>00</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2020</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>09</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>11</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>01</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>14</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>task_active_workers_version</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2019</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>00</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>09</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2020</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>09</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>11</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>07</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>08</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>tables</span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2019</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>00</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>25</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2019</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>00</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>25</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>task_active_workers</span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2019</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>00</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>09</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2019</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>00</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>09</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-- Running workers
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>system</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>zookeeper</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>path</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&lt;task-path&gt;/task_active_workers&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-- The list of processed tables
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>system</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>zookeeper</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>path</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&lt;task-path&gt;/tables&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-- The list of processed partitions
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>system</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>zookeeper</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>path</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&lt;task-path&gt;/tables/&lt;table&gt;&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>name</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ctime</span><span style=color:#f8f8f8;text-decoration:underline>           
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-------+--------------------
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#0000cf;font-weight:700>201909</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2019</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>24</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-- The status of a partition
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>system</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>zookeeper</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>path</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&lt;task-path&gt;/tables/&lt;table&gt;/&lt;partition&gt;&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>name</span><span style=color:#f8f8f8;text-decoration:underline>                     </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ctime</span><span style=color:#f8f8f8;text-decoration:underline>           
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-------------------------+--------------------
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>shards</span><span style=color:#f8f8f8;text-decoration:underline>                   </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2019</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>24</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>partition_active_workers</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2019</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>24</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-- The status of source shards
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>system</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>zookeeper</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>path</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&lt;task-path&gt;/tables/&lt;table&gt;/&lt;partition&gt;/shards&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>name</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ctime</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>mtime</span><span style=color:#f8f8f8;text-decoration:underline>           
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-----+---------------------+--------------------
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2019</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>37</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>48</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2019</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>49</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>29</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-4907e613a878d5b7819f49cc367b9f3f>2 - clickhouse-copier 20.4 - 21.6</h1><div class=lead>clickhouse-copier 20.4 - 21.6</div><p>Clickhouse-copier was created to move data between clusters.
It runs simple <code>INSERT…SELECT</code> queries and can copy data between tables with different engine parameters and between clusters with different number of shards.
In the task configuration file you need to describe the layout of the source and the target cluster, and list the tables that you need to copy. You can copy whole tables or specific partitions.
Clickhouse-copier uses temporary distributed tables to select from the source cluster and insert into the target cluster.</p><p>The behavior of clickhouse-copier was changed in 20.4:</p><ul><li>Now clickhouse-copier inserts data into intermediate tables, and after the insert finishes successfully clickhouse-copier attaches the completed partition into the target table. This allows for incremental data copying, because the data in the target table is intact during the process. <strong>Important note:</strong> ATTACH PARTITION respects the <code>max_partition_size_to_drop</code> limit. Make sure the <code>max_partition_size_to_drop</code> limit is big enough (or set to zero) in the destination cluster. If clickhouse-copier is unable to attach a partition because of the limit, it will proceed to the next partition, and it will drop the intermediate table when the task is finished (if the intermediate table is less than the <code>max_table_size_to_drop</code> limit). <strong>Another important note:</strong> ATTACH PARTITION is replicated. The attached partition will need to be downloaded by the other replicas. This can create significant network traffic between ClickHouse nodes. If an attach takes a long time, clickhouse-copier will log a timeout and will proceed to the next step.</li><li>Now clickhouse-copier splits the source data into chunks and copies them one by one. This is useful for big source tables, when inserting one partition of data can take hours. If there is an error during the insert clickhouse-copier has to drop the whole partition and start again. The <code>number_of_splits</code> parameter lets you split your data into chunks so that in case of an exception clickhouse-copier has to re-insert only one chunk of the data.</li><li>Now clickhouse-copier runs <code>OPTIMIZE target_table PARTITION ... DEDUPLICATE</code> for non-Replicated MergeTree tables. <strong>Important note:</strong> This is a very strange feature that can do more harm than good. We recommend to disable it by configuring the engine of the target table as Replicated in the task configuration file, and create the target tables manually if they are not supposed to be replicated. Intermediate tables are always created as plain MergeTree.</li></ul><h2 id=the-process-is-as-follows>The process is as follows</h2><ol><li>Process the configuration files.</li><li>Discover the list of partitions if not provided in the config.</li><li>Copy partitions one by one ** The metadata in ZooKeeper suggests the order described here.**<ol><li>Copy chunks of data one by one.<ol><li>Copy data from source shards one by one.<ol><li>Create intermediate tables on all shards of the target cluster.</li><li>Check the status of the chunk in ZooKeeper.</li><li>Drop the partition from the intermediate table if the previous attempt was interrupted.</li><li>Insert the chunk of data into the intermediate tables.</li><li>Mark the shard as completed in ZooKeeper</li></ol></li></ol></li><li>Attach the chunks of the completed partition into the target table one by one<ol><li>Attach a chunk into the target table.</li><li><strong>non-Replicated:</strong> Run OPTIMIZE target_table DEDUPLICATE for the partition on the target table.</li></ol></li></ol></li><li>Drop intermediate tables (may not succeed if the tables are bigger than <code>max_table_size_to_drop</code>).</li></ol><p>If there are several workers running simultaneously, they will assign themselves to different source shards.
If a worker was interrupted, another worker can be started to continue the task. The next worker will drop incomplete partitions and resume the copying.</p><h2 id=configuring-the-engine-of-the-target-table>Configuring the engine of the target table</h2><p>Clickhouse-copier uses the engine from the task configuration file for these purposes:</p><ul><li>to create target and intermediate tables if they don’t exist.</li><li>PARTITION BY: to SELECT a partition of data from the source table, to ATTACH partitions into target tables, to DROP incomplete partitions from intermediate tables, to OPTIMIZE partitions after they are attached to the target.</li><li>ORDER BY: to SELECT a chunk of data from the source table.</li></ul><p>Here is an example of SELECT that clickhouse-copier runs to get the sixth of ten chunks of data:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#204a87;font-weight:700>WHERE</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>the</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PARTITION</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>BY</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>clause</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>a</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>value</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>of</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>the</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PARTITION</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>BY</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>expression</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>AS</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>partition_key</span><span style=color:#000;font-weight:700>))</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>AND</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cityHash64</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>the</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>ORDER</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>BY</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>clause</span><span style=color:#ce5c00;font-weight:700>&gt;</span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>%</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>6</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Clickhouse-copier does not support the old MergeTree format.
However, you can create the intermediate tables manually with the same engine as the target tables (otherwise ATTACH will not work), and specify the engine in the task configuration file in the new format so that clickhouse-copier can parse it for SELECT, ATTACH PARTITION and DROP PARTITION queries.</p><p><strong>Important note</strong>: always configure engine as Replicated to disable OPTIMIZE … DEDUPLICATE (unless you know why you need clickhouse-copier to run OPTIMIZE … DEDUPLICATE).</p><h2 id=how-to-configure-the-number-of-chunks>How to configure the number of chunks</h2><p>The default value for <code>number_of_splits</code> is 10.
You can change this parameter in the <code>table</code> section of the task configuration file. We recommend setting it to 1 for smaller tables.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;cluster_push&gt;</span>target_cluster<span style=color:#204a87;font-weight:700>&lt;/cluster_push&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;database_push&gt;</span>target_database<span style=color:#204a87;font-weight:700>&lt;/database_push&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;table_push&gt;</span>target_table<span style=color:#204a87;font-weight:700>&lt;/table_push&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;number_of_splits&gt;</span>1<span style=color:#204a87;font-weight:700>&lt;/number_of_splits&gt;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>&lt;engine&gt;</span>Engine=Replicated...<span style=color:#204a87;font-weight:700>&lt;engine&gt;</span>
</span></span></code></pre></div><h2 id=how-to-monitor-the-status-of-running-tasks>How to monitor the status of running tasks</h2><p>Clickhouse-copier uses ZooKeeper to keep track of the progress and to communicate between workers.
Here is a list of queries that you can use to see what’s happening.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#8f5902;font-style:italic>--task-path=/clickhouse/copier/task1
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-- The task config
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>system</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>zookeeper</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>path</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&lt;task-path&gt;&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>name</span><span style=color:#f8f8f8;text-decoration:underline>                        </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ctime</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>mtime</span><span style=color:#f8f8f8;text-decoration:underline>           
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>----------------------------+---------------------+--------------------
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>description</span><span style=color:#f8f8f8;text-decoration:underline>                 </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>48</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>25</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>28</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>status</span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>48</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>25</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>28</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>task_active_workers_version</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>48</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>32</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>09</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>tables</span><span style=color:#f8f8f8;text-decoration:underline>                      </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>47</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>47</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>task_active_workers</span><span style=color:#f8f8f8;text-decoration:underline>         </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>48</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>15</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>48</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-- Status
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>system</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>zookeeper</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>path</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&lt;task-path&gt;/status&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-- Running workers
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>system</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>zookeeper</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>path</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&lt;task-path&gt;/task_active_workers&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-- The list of processed tables
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>system</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>zookeeper</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>path</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&lt;task-path&gt;/tables&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-- The list of processed partitions
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>system</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>zookeeper</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>path</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&lt;task-path&gt;/tables/&lt;table&gt;&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>name</span><span style=color:#f8f8f8;text-decoration:underline>   </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ctime</span><span style=color:#f8f8f8;text-decoration:underline>           
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-------+--------------------
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#0000cf;font-weight:700>202103</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>16</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>47</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>202102</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>202101</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>27</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>36</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#0000cf;font-weight:700>202012</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>14</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>05</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>08</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-- The status of a partition
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>system</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>zookeeper</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>path</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&lt;task-path&gt;/tables/&lt;table&gt;/&lt;partition&gt;&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>name</span><span style=color:#f8f8f8;text-decoration:underline>           </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ctime</span><span style=color:#f8f8f8;text-decoration:underline>           
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>---------------+--------------------
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>piece_0</span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>attach_is_done</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>14</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>05</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>05</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-- The status of a piece
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>system</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>zookeeper</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>path</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&lt;task-path&gt;/tables/&lt;table&gt;/&lt;partition&gt;/piece_N&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>name</span><span style=color:#f8f8f8;text-decoration:underline>                           </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ctime</span><span style=color:#f8f8f8;text-decoration:underline>           
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-------------------------------+--------------------
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>shards</span><span style=color:#f8f8f8;text-decoration:underline>                         </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>18</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>31</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>is_dirty</span><span style=color:#f8f8f8;text-decoration:underline>                       </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>26</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>51</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>partition_piece_active_workers</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>26</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>54</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>clean_start</span><span style=color:#f8f8f8;text-decoration:underline>                    </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>26</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>54</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-- The status of source shards
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>select</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>from</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>system</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>zookeeper</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>where</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>path</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&lt;task-path&gt;/tables/&lt;table&gt;/&lt;partition&gt;/piece_N/shards&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>name</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ctime</span><span style=color:#f8f8f8;text-decoration:underline>               </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>mtime</span><span style=color:#f8f8f8;text-decoration:underline>           
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#8f5902;font-style:italic>-----+---------------------+--------------------
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>13</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>26</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>54</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#ce5c00;font-weight:700>|</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>2021</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>03</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>22</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>14</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>05</span><span style=color:#000;font-weight:700>:</span><span style=color:#0000cf;font-weight:700>05</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-092d5c190f9504b9126ab5f7779a2089>3 - Kubernetes job for clickhouse-copier</h1><div class=lead>Kubernetes job for clickhouse-copier</div><h1 id=clickhouse-copier-deployment-in-kubernetes>ClickHouse-copier deployment in kubernetes</h1><p>Clickhouse-copier can be deployed in a kubernetes environment to automate some simple backups or copy fresh data between clusters.</p><p>Some documentation to read:</p><ul><li><a href=https://kb.altinity.com/altinity-kb-setup-and-maintenance/altinity-kb-data-migration/altinity-kb-clickhouse-copier/ target=_blank>https://kb.altinity.com/altinity-kb-setup-and-maintenance/altinity-kb-data-migration/altinity-kb-clickhouse-copier/</a></li><li><a href=https://clickhouse.com/docs/en/operations/utilities/clickhouse-copier/ target=_blank>https://clickhouse.com/docs/en/operations/utilities/clickhouse-copier/</a></li></ul><h2 id=deployment>Deployment</h2><p>Use a kubernetes job is recommended but a simple pod can be used if you only want to execute the copy one time.</p><p>Just edit/change all the <code>yaml</code> files to your needs.</p><h3 id=1-create-the-pvc>1) Create the PVC:</h3><p>First create a namespace in which all the pods and resources are going to be deployed</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create namespace clickhouse-copier
</span></span></code></pre></div><p>Then create the PVC using a <code>storageClass</code> gp2-encrypted class or use any other storageClass from other providers:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>PersistentVolumeClaim</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>copier-logs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>clickhouse-copier</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>storageClassName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>gp2-encrypted</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>accessModes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#000>ReadWriteOnce</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>requests</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>storage</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>100Mi</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>and deploy:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n clickhouse-copier create -f ./kubernetes/copier-pvc.yaml
</span></span></code></pre></div><h3 id=2-create-the-configmap>2) Create the configmap:</h3><p>The configmap has both files <code>zookeeper.xml</code> and <code>task01.xml</code> with the zookeeper node listing and the parameters for the task respectively.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ConfigMap</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>copier-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>clickhouse-copier</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>task01.xml</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        &lt;clickhouse&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &lt;logger&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;console&gt;true&lt;/console&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;log remove=&#34;remove&#34;/&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;errorlog remove=&#34;remove&#34;/&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;level&gt;trace&lt;/level&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &lt;/logger&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &lt;remote_servers&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;all-replicated&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;shard&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                        &lt;replica&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                            &lt;host&gt;clickhouse01.svc.cluster.local&lt;/host&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                            &lt;port&gt;9000&lt;/port&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                            &lt;user&gt;chcopier&lt;/user&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                            &lt;password&gt;pass&lt;/password&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                        &lt;/replica&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                        &lt;replica&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                            &lt;host&gt;clickhouse02.svc.cluster.local&lt;/host&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                            &lt;port&gt;9000&lt;/port&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                            &lt;user&gt;chcopier&lt;/user&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                            &lt;password&gt;pass&lt;/password&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                        &lt;/replica&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;/shard&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;/all-replicated&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;all-sharded&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;!-- &lt;secret&gt;&lt;/secret&gt; --&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;shard&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                        &lt;replica&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                            &lt;host&gt;clickhouse03.svc.cluster.local&lt;/host&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                            &lt;port&gt;9000&lt;/port&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                            &lt;user&gt;chcopier&lt;/user&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                            &lt;password&gt;pass&lt;/password&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                        &lt;/replica&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;/shard&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;shard&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                        &lt;replica&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                            &lt;host&gt;clickhouse03.svc.cluster.local&lt;/host&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                            &lt;port&gt;9000&lt;/port&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                            &lt;user&gt;chcopier&lt;/user&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                            &lt;password&gt;pass&lt;/password&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                        &lt;/replica&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;/shard&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;/all-sharded&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &lt;/remote_servers&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &lt;max_workers&gt;1&lt;/max_workers&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &lt;settings_pull&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;readonly&gt;1&lt;/readonly&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &lt;/settings_pull&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &lt;settings_push&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;readonly&gt;0&lt;/readonly&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &lt;/settings_push&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &lt;settings&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;connect_timeout&gt;3&lt;/connect_timeout&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;insert_distributed_sync&gt;1&lt;/insert_distributed_sync&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &lt;/settings&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &lt;tables&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;table_sales&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;cluster_pull&gt;all-replicated&lt;/cluster_pull&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;database_pull&gt;default&lt;/database_pull&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;table_pull&gt;fact_sales_event&lt;/table_pull&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;cluster_push&gt;all-sharded&lt;/cluster_push&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;database_push&gt;default&lt;/database_push&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;table_push&gt;fact_sales_event&lt;/table_push&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;engine&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                        Engine=ReplicatedMergeTree(&#39;/clickhouse/{cluster}/tables/{shard}/fact_sales_event&#39;, &#39;{replica}&#39;)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                        PARTITION BY toYYYYMM(timestamp)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                        ORDER BY (channel_id, product_id)
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                        SETTINGS index_granularity = 8192
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;/engine&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;sharding_key&gt;rand()&lt;/sharding_key&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;/table_ventas&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &lt;/tables&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        &lt;/clickhouse&gt;</span><span style=color:#f8f8f8;text-decoration:underline>        
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>zookeeper.xml</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        &lt;clickhouse&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &lt;logger&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;level&gt;trace&lt;/level&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;size&gt;100M&lt;/size&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;count&gt;3&lt;/count&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &lt;/logger&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &lt;zookeeper&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;node&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;host&gt;zookeeper1.svc.cluster.local&lt;/host&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;port&gt;2181&lt;/port&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;/node&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;node&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;host&gt;zookeeper2.svc.cluster.local&lt;/host&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;port&gt;2181&lt;/port&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;/node&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;node&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;host&gt;zookeeper3.svc.cluster.local&lt;/host&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &lt;port&gt;2181&lt;/port&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &lt;/node&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &lt;/zookeeper&gt;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        &lt;/clickhouse&gt;</span><span style=color:#f8f8f8;text-decoration:underline>        
</span></span></span></code></pre></div><p>and deploy:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n clickhouse-copier create -f ./kubernetes/copier-configmap.yaml
</span></span></code></pre></div><p>The <code>task01.xml</code> file has many parameters to take into account explained in the <a href=https://clickhouse.com/docs/en/operations/utilities/clickhouse-copier/ target=_blank>clickhouse-copier documentation</a>. Important to note that it is needed a FQDN for the zookeeper nodes and clickhouse server that are valid for the cluster. As the deployment creates a new namespace, it is recommended to use a FQDN linked to a service. For example <code>zookeeper01.svc.cluster.local</code>. This file should be adapted to both clusters topologies and to the needs of the user.</p><p>The <code>zookeeper.xml</code> file is pretty straightforward with a simple 3 node ensemble configuration.</p><h3 id=3-create-the-job>3) Create the job:</h3><p>Basically the job will download the official clickhouse image and will create a pod with 2 containers:</p><ul><li><p>clickhouse-copier: This container will run the clickhouse-copier utility.</p></li><li><p>sidecar-logging: This container will be used to read the logs of the clickhouse-copier container for different runs (this part can be improved):</p></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>batch/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Job</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>clickhouse-copier-test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>clickhouse-copier</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># only for kubernetes 1.23</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># ttlSecondsAfterFinished: 86400</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>template</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>containers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>clickhouse-copier</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>clickhouse/clickhouse-server:21.8</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>command</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#000>clickhouse-copier</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- --<span style=color:#000>task-upload-force=1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- --<span style=color:#000>config-file=$(CH_COPIER_CONFIG)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- --<span style=color:#000>task-path=$(CH_COPIER_TASKPATH)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- --<span style=color:#000>task-file=$(CH_COPIER_TASKFILE)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- --<span style=color:#000>base-dir=$(CH_COPIER_BASEDIR)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>env</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CH_COPIER_CONFIG</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/var/lib/clickhouse/tmp/zookeeper.xml&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CH_COPIER_TASKPATH</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/clickhouse/copier/tasks/task01&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CH_COPIER_TASKFILE</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/var/lib/clickhouse/tmp/task01.xml&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CH_COPIER_BASEDIR</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;/var/lib/clickhouse/tmp&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>limits</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>cpu</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;1&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>2048Mi</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>volumeMounts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>copier-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>mountPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/var/lib/clickhouse/tmp/zookeeper.xml</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>subPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>zookeeper.xml</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>copier-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>mountPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/var/lib/clickhouse/tmp/task01.xml</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>subPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>task01.xml</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>copier-logs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>mountPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/var/lib/clickhouse/tmp</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>sidecar-logger</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>busybox:1.35</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>command</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#39;/bin/sh&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;-c&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;tail&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;-n&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;1000&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;-f&#39;</span><span style=color:#000;font-weight:700>,</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;/tmp/copier-logs/clickhouse-copier*/*.log&#39;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>limits</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>cpu</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;1&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>memory</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>512Mi</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>volumeMounts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>copier-logs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span><span style=color:#204a87;font-weight:700>mountPath</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/tmp/copier-logs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>volumes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>copier-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>configMap</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>copier-config</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>items</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>zookeeper.xml</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>zookeeper.xml</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>              </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>task01.xml</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>                </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>task01.xml</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>copier-logs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>persistentVolumeClaim</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>claimName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>copier-logs</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>restartPolicy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Never</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>backoffLimit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#0000cf;font-weight:700>3</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Deploy and watch progress checking the logs:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n clickhouse-copier logs &lt;podname&gt; sidecar-logging
</span></span></code></pre></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel="noopener noreferrer" href=https://twitter.com/AltinityDB><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Youtube aria-label=Youtube><a class=text-white target=_blank rel="noopener noreferrer" href=https://www.youtube.com/channel/UCE3Y2lDKl_ZfjaCrh62onYA><i class="fab fa-youtube"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=LinkedIn aria-label=LinkedIn><a class=text-white target=_blank rel="noopener noreferrer" href=https://www.linkedin.com/company/altinity/><i class="fab fa-linkedin"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/orgs/Altinity/><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 Altinity Inc. Altinity® and Altinity.Cloud® are registered trademarks of Altinity, Inc. ClickHouse® is a registered trademark of ClickHouse, Inc. All Rights Reserved</small>
<small class=ml-1><a href=https://altinity.com/privacy-policy/ target=_blank>Privacy Policy</a></small></div></div></div><script async src="https://www.googletagmanager.com/gtag/js?id=UA-101676615-2"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-101676615-2")</script></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.91798a335c881f1b6b805085ba4aa22d1dbd2b0b18d105d05189fa104ddae350.js integrity="sha256-kXmKM1yIHxtrgFCFukqiLR29KwsY0QXQUYn6EE3a41A=" crossorigin=anonymous></script>
<script src=/js/prism.js></script></body></html>